
---

# 2025-11-17–18 LAM3 Daily Experiment Log

## 1. Overview

* Responsible: JsW

* Branch: `feat/feasibility`

* Target Models (被攻击对象): LLaVA-1.5-7B, IDEFICS2-8B（本轮日志主要聚焦于评测与裁判侧）

* Judge Model (裁判): Qwen 系列文本模型（单裁判设置）

* New Components / Concepts:

  * Synergy 评测与统计脚本（基于 `synergy_jbv28k` mini 子集）
  * 跨模态增益指标 **D**（multi-modal gain metric）
  * Synergy 类型划分：`strict / text-dominant / image-dominant / other`
  * D–ASR / D–Refusal 平滑可视化逻辑（滑动窗口 + 排序）

* Dataset: `synergy_jbv28k` mini 子集（约 124 个 unique id），四种模式：`txt_img / txt_only / img_only / none`

* Goal of the days:

  1. 基于 Qwen 裁判，拿到首批可用的 synergy 统计结果（ASR / Refusal / Tail Prob）。
  2. 定义并实现跨模态增益指标 D，分析其与 ASR / Refusal 的关系。
  3. 探索适合论文呈现的可视化方案（分模态 / 分类型 / 分区间），为“跨模态不一致性验证”搭建分析框架。

---

## 2. Parameters & Settings

### 2.1 Evaluation（Synergy 配置）

> 以下为本轮分析中隐含使用的关键设定（概念与代码行为对齐）。

| Category     | Key / Concept                         | Value / Setting                               | Notes                  |
| ------------ | ------------------------------------- | --------------------------------------------- | ---------------------- |
| Dataset      | `N_ids`                               | ≈ 124                                         | synergy_jbv28k mini 子集 |
| Modes        | `modes`                               | `["txt_img", "txt_only", "img_only", "none"]` | 多模态 / 文本 / 图像 / 无显式攻击  |
| Judge        | `judge_model`                         | Qwen 系列                                       | 单裁判，负责判定 ASR/Refusal   |
| Metric       | `ASR`                                 | Attack Success Rate                           | 判为“越狱成功”的比例            |
| Metric       | `Refusal`                             | 模型显式拒绝比例（由 judge 判定）                          |                        |
| Metric       | `Tail(R ≥ 0.8)`                       | 高置信度有害响应尾部概率                                  | 判定标准来自 Qwen 裁判打分       |
| Synergy Type | `strict / textdom / imagedom / other` | 基于四模式 ASR 关系进行规则划分                            | 详见 Observations        |
| D Metric     | `D`                                   | 基于 `txt_img` 相对单模态/none 的 ASR 增益（具体形式略）       | 只用于相对比较，不用于绝对打分        |

### 2.2 Plotting / Smoothing（可视化相关）

> 这些设定主要体现在 D–ASR / D–Refusal 平滑曲线绘制中。

| Category | Key                       | Value / Rule           | Notes                                 |
| -------- | ------------------------- | ---------------------- | ------------------------------------- |
| Sorting  | `Ds_sorted`               | 按 D 从小到大排序后的列表         | 与对应的 `asr_sorted / refusal_sorted` 对齐 |
| Window   | `win`                     | `max(10, n // 20)`     | 约 5%–10% 的样本数量，用于滑动平均                 |
| Output   | `centers`                 | 每个窗口内 D 的平均值           | 作为横轴点                                 |
| Output   | `asr_smooth / ref_smooth` | 窗口内 ASR / Refusal 的平均值 | 作为纵轴平滑曲线                              |

---

## 3. Observations / Results

### 3.1 按模式划分的 ASR / Refusal 统计（基于 Qwen 裁判）

在约 **124** 条样本上，对四种模态组合分别评测，得到：

* `txt_img`（文本 + 图像）

  * ASR ≈ **0.984**
  * Refusal ≈ **0.016**
  * Tail(R≥0.8) ≈ **0.895**

* `txt_only`（仅文本）

  * ASR ≈ **0.661**
  * Refusal ≈ **0.177**
  * Tail(R≥0.8) ≈ **0.573**

* `img_only`（仅图像）

  * ASR ≈ **0.089**
  * Refusal ≈ **0.250**
  * Tail(R≥0.8) ≈ **0.073**

* `none`（无显式攻击提示）

  * ASR ≈ **0.000**
  * Refusal ≈ **0.065**
  * Tail(R≥0.8) ≈ **0.000**

直接结论：

1. **多模态输入（txt_img）显著提升越狱成功率**：从文本单模态 0.661 → 多模态 0.984，说明图像在许多 case 中提供了额外突破口或强化了攻击意图。
2. `img_only` 模式 ASR 非零，表明存在少量 **image-driven 攻击样本**，但总体占比远低于 text-driven。
3. `none` 模式 ASR ≈ 0，基本符合预期，说明数据与评测流程在“无攻击提示”下没有明显伪越狱问题。

### 3.2 Synergy 类型划分与分布

在四模式 ASR 的基础上，按照规则将每个 id 分类为：

* **strict synergy**：`txt_img` 高 ASR，且所有单模态/none 模式 ASR 低。
* **text-dominant synergy（textdom）**：文本本身已经较强（`txt_only` ASR 已高），但 `txt_img` 仍有明显增益。
* **image-dominant synergy（imagedom）**：图像单模态贡献更大。
* **other**：难以归类或边缘情况。

当前 mini 集合上的统计（按 id 计）：

* strict：n_ids ≈ **30**
* textdom：n_ids ≈ **81**
* imagedom：n_ids ≈ **11**
* other：n_ids ≈ **2**

同时统计了若干综合指标（示意）：

* `strict_synergy_asr_rate ≈ 0.242`
* `textdom_synergy_asr_rate ≈ 0.331`

直观意义：
大部分攻击样本属于 **text-dominant** 或 **strict synergy**，image-dominant 样本较少，但仍然存在，说明“图像驱动越狱”在真实数据中是一个小而重要的子集。

### 3.3 D 指标（跨模态增益）与 ASR/Refusal 的关系

定义 D 为某种形式的“多模态相对单模态的 ASR 增益”（例如相对 max 或某种加权 baseline），并对每个 id 计算一个标量 D。

1. **D–ASR 平滑曲线（17–18 日迭代）**

   * 按 D 排序后，使用滑动窗口进行平均：

     * 横轴：窗口内 D 的平均值（centers）
     * 纵轴：窗口内 `txt_img` ASR/Refusal 的平均值
   * 实验结果：

     * 整体趋势符合预期：D 越大，`txt_img` ASR 越高，Refusal 越低。
     * 但中间区间仍存在明显波动，曲线不够单调，说明 D 更多是“定性辅助指标”，不能作为单一解释变量。

2. **可视化策略调整**
   在多轮调参后，结论是：

   * 不再追求“一条完美平滑的 D–ASR 曲线”；
   * 更倾向于使用 **D 分箱 + 分组统计** 的方式，例如：

     * 将 D 按 quantile / 固定区间划分为 4–5 个桶，统计每个桶的平均 ASR / Refusal；
     * 对 strict / textdom / imagedom 子集分别绘制分箱曲线（或条形图），对比不同类型内部的 D 效应。
   * 这样在论文中更容易解释，也有利于控制噪声和样本不均的问题。

### 3.4 “跨模态不一致性验证”的展示思路

结合目前的数据与分析，已经基本收敛出一套适合论文展示的结构：

1. **模式级对比表**：列出 `txt_img / txt_only / img_only / none` 的 ASR / Refusal / Tail(R≥0.8)，用于说明“多模态明显更危险”。
2. **Synergy 类型分布图**：展示 strict / textdom / imagedom / other 的比例，强调 textdom 与 strict 为主力，imagedom 虽少但不可忽视。
3. **D 分箱曲线（分类型）**：展示在相同 synergy 类型内，D 越大，越狱成功率越高，构成对“跨模态增益 → 风险提升”的统计证据。

这些设计将直接为后续论文第 4/5 章的实验分析部分服务。

---

## 4. Issues & Bug Tracking

> 本节仅记录与 11.17–18 日新引入的分析相关的问题；此前 runtime / toxicity / wrapper 相关 issue 继续在旧日志中生效。

| ID          | Description                                                               | Severity | Status | Note                                                        |
| ----------- | ------------------------------------------------------------------------- | -------- | ------ | ----------------------------------------------------------- |
| B20251117-1 | 单一 D–ASR 平滑曲线存在局部噪声，趋势不够单调，难以作为强证据使用                                      | Medium   | Open   | 需改用 D 分箱统计，以及与 synergy 类型结合的分组可视化                           |
| B20251117-2 | 当前所有 ASR/Refusal 统计仅依赖单一裁判（Qwen），裁判偏好会直接影响数值与尾部概率                         | High     | Open   | 后续必须引入其他 judge（OpenAI moderation / Llama-Guard / 小模型）进行交叉验证 |
| B20251117-3 | Synergy 类型划分依赖固定规则，对边缘样本的鲁棒性尚未系统验证                                        | Medium   | Open   | 需要对规则做敏感性分析，并考虑在附录中给出若干典型 case 示例                           |
| B20251118-1 | D 的定义目前只在代码和实验日志中出现，对外叙述不够直观，缺乏“人类可读”的说明和简单示例                             | Medium   | Open   | 需要在论文草稿与仓库文档中增加 D 的正式定义与解释                                  |
| B20251118-2 | 目前 synergy 评测与后续 cross-attention 梯度攻击实验在样本 id 和模式命名上尚未完全对齐，存在后期 join 出错风险 | Medium   | Open   | 后续 attack 脚本需严格复用 synergy meta 的 id 与 mode 字段               |

---

## 5. Next Actions

### 5.1 短期（接下来 1–2 天）

1. **实现 D 分箱 + 分类型可视化脚本**

   * 输入：`per-id` 的 D 值、ASR/Refusal、synergy type、mode 信息。
   * 输出：

     * D 分箱 vs 平均 ASR/Refusal 曲线；
     * strict / textdom / imagedom 分组子图，观察每类内部的 D 影响。

2. **在 synergy_jbv28k 的 summary 输出中增加 D 统计**

   * 对每个 D 区间统计：样本数、平均 ASR、平均 Refusal；
   * 标记关键区间（如 D ≥ 某阈值）中 strict / textdom 样本占比，用于做“高增益高风险”论据。

3. **撰写 D 指标说明草稿**

   * 内容包括：

     * D 的数学定义或规则；
     * 一个简单 toy 示例说明如何从四模式 ASR 计算 D；
     * D 与“跨模态泄露风险”的对应关系。

### 5.2 中期（本周内）

1. **多裁判扩展计划**

   * 将当前 synergy 输出格式对齐到一个统一 schema，方便后续接入：

     * Llama-Guard-2-8B（policy-aware judge）
     * OpenAI moderation / 其他 API（在本地可联网环境执行）
     * 小参数安全模型（辅助判定）
   * 对比不同 judge 在同一批样本上的 ASR/Refusal 判定差异。

2. **与攻击模块对齐**

   * 在后续 cross-attention 梯度攻击实验中：

     * 明确每条样本的 id 与模式（txt_img / txt_only / img_only / none）；
     * 确保 attack 结果能与现有 synergy 统计按 id 精确 join，支持“攻击前后 D/ASR 变化”的联合分析。

---

## 6. Commit & Sync

* Git Branch: `feat/feasibility`
* Git Commits: 最新若干提交已推送至远端（具体 hash 可根据 `git log --oneline` 补充）
* Suggested Log File: `outputs/daily_logs/20251117-18.md`
* Timestamp: 2025-11-18 (Asia/Singapore)

---
